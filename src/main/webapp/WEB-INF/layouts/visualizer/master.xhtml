<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>PowerTAC Visualizer</title>
	<ui:insert name="headInclude" />
	<h:outputScript library="js" name="scripts.js" />
	<h:outputStylesheet library="css" name="visualizer.css" />
	<h:outputScript library="js" name="highcharts.js"/>
	<h:outputScript library="js" name="highstock.js"/>
	<h:outputScript library="js/modules" name="exporting.js"/>
	<script type='text/javascript' src='https://www.google.com/jsapi'/>
	
	<script type="text/javascript">
	
		
	
		var windSpeed = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.windSpeed:0 }*100)/100;
		var temperature = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.temperature:0}*100)/100;
		var cover = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.cloudCover: 0}*100)/100;
		
	
	var cashChartGlobal;
		var subscriptionsPieChart;
		
		var windSpeedData;
		var cloudCoverData;
		var temperatureData;
		var windSpeedOptions;
		var cloudCoverOptions;
		var temperatureOptions;
		var windSpeedGauge;
		var cloudCoverGauge;
		var temperatureGauge;
		var weatherGaugesDefined=false;
		
	      google.load('visualization', '1', {packages:['gauge']});
	      
	      
	         
	      google.setOnLoadCallback(drawCharts);

	      function drawCharts() {
	    	 windSpeedData = google.visualization.arrayToDataTable([
	          ['Label', 'Value'],
	          ['Wind(m/s)', windSpeed]
	        ]);
	        
	         cloudCoverData = google.visualization.arrayToDataTable([
	            ['Label', 'Value'],
	            ['Clouds', cover]
	        ]);
	        
	         temperatureData = google.visualization.arrayToDataTable([
	                                                    	            ['Label', 'Value'],
	                                                    	            ['Temp.(Â°C)', temperature]
	                                                    	        ]);

	         windSpeedOptions = {
	          min: 0, max: 20,
	          width: 85, height: 85,
	          //redFrom: 90, redTo: 100,
	          //yellowFrom:75, yellowTo: 90,
	          minorTicks: 5
	        };
	         cloudCoverOptions = {
	  	          min: 0, max: 1,
	  	          width: 85, height: 85,
	  	          //redFrom: 90, redTo: 100,
	  	          //yellowFrom:75, yellowTo: 90,
	  	          minorTicks: 5
	  	        };
	        
	         temperatureOptions = {
		  	          min: 0, max: 30,
		  	          width: 85, height: 85,
		  	          //redFrom: 90, redTo: 100,
		  	          //yellowFrom:75, yellowTo: 90,
		  	          minorTicks: 5
		  	        };

	         windSpeedGauge = new google.visualization.Gauge(document.getElementById('windSpeedGauge'));
	        windSpeedGauge.draw(windSpeedData, windSpeedOptions);
	        
	         cloudCoverGauge = new google.visualization.Gauge(document.getElementById('cloudCoverGauge'));
	        cloudCoverGauge.draw(cloudCoverData, cloudCoverOptions);
	        
	         temperatureGauge = new google.visualization.Gauge(document.getElementById('temperatureGauge'));
	        temperatureGauge.draw(temperatureData, temperatureOptions);
	        
	        weatherGaugesDefined = true;
	      };
	   
	  
				
		

		
		
	</script>
	<ui:insert name="headIncludes" />

</h:head>
<h:body>

	<p:layout id="mainLayout" fullPage="true" stateful="true" >
		<p:layoutUnit id="north" position="north" size="90" collapsible="true"
			header="LOL" styleClass="custom" resizable="true">
			<ui:include src="/WEB-INF/tags/logo.xhtml" />
			
			
			<h:form id="northForm">
			
			<script type="text/javascript">
			
			if(weatherGaugesDefined){
				
				var windSpeed = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.windSpeed:0 }*100)/100;
				var temperature = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.temperature:0}*100)/100;
				var cover = Math.round(#{not empty weatherInfoService.currentReport ? weatherInfoService.currentReport.cloudCover: 0}*100)/100;
				
				//alert('speed '+windSpeed+' temp:'+temperature+' cover: '+cover);
				
     
				
				windSpeedData.setValue(0, 1, windSpeed);
				windSpeedGauge.draw(windSpeedData, windSpeedOptions);
				
				cloudCoverData.setValue(0, 1, cover);
				cloudCoverGauge.draw(cloudCoverData, cloudCoverOptions);
				
				temperatureData.setValue(0, 1,temperature);
				temperatureGauge.draw(temperatureData, temperatureOptions);
			}
			
</script>
			
				<table cellspacing="5" style="float:right">
					<tr>
						<th>Time:</th>
						<th>Timeslot:</th>
						<th>Name:</th>
						<th>Description:</th>
											
						
						
					</tr>
					<tr>
					<th><h:outputText value="#{visualizerBean.timeslotUpdate.postedTime.millis}" >
						<f:convertDateTime type="both" pattern="HH:mm, E, MMM d, y"/>
						</h:outputText>  </th>
						<td>#{visualizerBean.currentTimeslotSerialNumber}</td>
						<td>#{visualizerBean.competition.name}</td>
						<td>#{visualizerBean.competition.description}</td>
						<td><p:button icon="ui-icon-wrench" title="Go to the Admin page." href="competitioncontrol"/>	</td>

					</tr>
				</table>
			
						
						

			</h:form>
			<div id="cloudCoverGauge" style="float:right"/>
			<div id="windSpeedGauge" style="float:right"/>
			<div id="temperatureGauge" style="float:right"/>
			
			
		</p:layoutUnit>

		<p:layoutUnit position="center" resizable="true">
			<h2 class="alt" style="text-align: center;">

				<ui:insert name="title"></ui:insert>

			</h2>

			<ui:insert name="content" />

		</p:layoutUnit>

		<p:layoutUnit position="east" size="400" collapsible="true"
			header="LOL" styleClass="custom" resizable="true">

			<ui:include src="/WEB-INF/tags/tableBrokers.xhtml" />
			<ui:include src="/WEB-INF/tags/cashChartGlobal.xhtml" />
			<ui:include src="/WEB-INF/tags/subscriptionsPieChart.xhtml" />
			<p:lineChart style="height: 1px; width: 1px;"
				value="#{imageControl.fakeChart}" rendered="false" />
		
		</p:layoutUnit>

		<p:layoutUnit position="south" size="20" >
			<p:dock>
				<p:menuitem value="Game Overview"
					icon="/app/resources/resources/images/dock/eye.png"
					url="gameoverview" />
				<p:menuitem value="Brokers"
					icon="/app/resources/resources/images/dock/brokers.png"
					url="brokers" />
				<p:menuitem value="Customers"
					icon="/app/resources/resources/images/dock/customers.png"
					url="customers" />
				<p:menuitem value="GenCos"
					icon="/app/resources/resources/images/dock/gencos.png" url="gencos" />
				<p:menuitem value="Wholesale"
					icon="/app/resources/resources/images/dock/wholesale.png"
					url="wholesale" />
				<p:menuitem value="Weather"
					icon="/app/resources/resources/images/dock/weather.png"
					url="weather" />
			</p:dock>
		</p:layoutUnit>

	</p:layout>

	<h:form>
		<p:poll autoStart="true" interval="5"
			update=":tableBrokersForm,:northForm, :cashChartGlobalForm, :subscriptionsPieChartForm" />
	</h:form>

</h:body>

</html>
